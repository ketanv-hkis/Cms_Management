
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<form>
    <div class="row">
        <div class="col">
             <div class="dropdown">

                @Html.DropDownList("Team", (List<SelectListItem>)ViewData["teams"], new { onchange = "SelectedIndexChanged(this.value)" })

            <input type="text" name="Addteam" id="textaddteam" class="text hide" />
             </div>
        </div>

        <div class="col">
            <button type="button" id="btnplus" class="btn btn-primary"> + </button>
            <button type="button" id="btnsave" class="btn btn-primary hide" onclick="getEmployeeList()" > Save </button>
        </div>
    </div>

    <div id="empData">

    </div>

    <button type="button" id="btnSaveEmp" class="btn btn-primary hide">Save</button>

</form>


<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/jquery/dist/jquery.js"></script>

<script type="text/javascript">


    var checkedEmp = [];
    var Id = 0;
    

    $("#btnplus").on('click', function () {
        $(this).hide();
        $("#btnsave").show();
    });

    $("#btnplus").on('click', function(){
        $("#Team").hide();
        $("#textaddteam").show();

    });

    $("#btnsave").on('click', function () {
        $("#textaddteam").hide();
        $("#btnplus").show();
        $("#Team").show();
    });


    $(document).ready(function () {
        $('#btnsave').on('click', function () {
            var name = $('#textaddteam').val($(this).find("option:selected").text());
            $.ajax({
                type: "POST",
                url: "/Team/create",
                data: { 'name': name.toString() },
                dataType: "json",
                success: function (data) {
                }
            });
        });
    });

    //function getEmployeeList(){

    //    $('#btnsave').on('click', function () {
    //       $.ajax({
    //           type : "GET",
    //            url: "/Employee/Index",
    //            dataType: "Json",
    //            Success : function(data){
    //                console.log(data);
    //            }

    //       });
    //    })
    //}

    function SelectedIndexChanged(event){
        Id = event;
        $.ajax({
            type: "GET",
            url: "/Employee/Index",
            dataType: "json",
            success: function (data) {
                var emp='';
                for (var i = 0; i < data.length; i++) {
                    emp += '<input type="CheckBox" id="chk_' + data[i].id + '" onclick="selectEmployee(this)"><span>' + data[i].firstname + '</span></br>'
                
                }
                $("#empData").append(emp);
            }
        });
    }

    function selectEmployee(event){
        var id = event.id.split('_')[1];
        if(event.checked){
            checkedEmp.push(id);
        }else
        {
            checkedEmp = checkedEmp.filter(X => X != id);
        }
    }

    $("#Team").on('click', function () {
        $("#btnSaveEmp").show();
    });


    $("#btnSaveEmp").on('click', function () {
        var employee = checkedEmp.join(",");
        var teamAssign = { "EmpId": employee, "TeamId": parseInt(Id) }
        $.ajax({
            type: "POST",
            url: "/Team/saveTeamAssign",
            data: { 'teamAssign': teamAssign },
            dataType: "json",
            success: function (data) {
                console.log(data)
            }
        });

    });




</script>


<style>
    .dropdown {
        height: 35px;
        width: 10px;
    }

    #Team {
        height: 35px;
    }

    #btnplus {
        margin-left: -510px
    }

    .hide{
        display:none;
    }

    #btnsave{
        margin-left: -439px;
    }

    #textaddteam {
       height: 36px;
    }
</style>
